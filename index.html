<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta name="theme-color" content="#e74c3c">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="description" content="ãƒ˜ã‚¢ã‚«ãƒ©ãƒ¼ã«ã‚ˆã‚‹ã‚¸ã‚¢ãƒŸãƒ³ã‚¢ãƒ¬ãƒ«ã‚®ãƒ¼ã®ç™ºç—‡ãƒªã‚¹ã‚¯ã‚’å¯è¦–åŒ–ã™ã‚‹ã‚¢ãƒ—ãƒª">
<link rel="icon" type="image/svg+xml" href="/favicon.svg">
<link rel="apple-touch-icon" href="/favicon.svg">
<title>ã‚¸ã‚¢ãƒŸãƒ³ã‚¢ãƒ¬ãƒ«ã‚®ãƒ¼ç™ºç—‡ãƒªã‚¹ã‚¯è­¦å‘Š</title>
<style>
  *, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }

  :root {
    --red: #e74c3c;
    --dark-red: #c0392b;
    --bg: #1a1a2e;
    --card-bg: #16213e;
    --border: #2a2a4a;
    --safe-env-top: env(safe-area-inset-top, 0px);
    --safe-env-bottom: env(safe-area-inset-bottom, 0px);
  }

  html {
    -webkit-text-size-adjust: 100%;
    -webkit-tap-highlight-color: transparent;
  }

  body {
    font-family: -apple-system, BlinkMacSystemFont, 'Hiragino Sans',
                 'Hiragino Kaku Gothic ProN', 'Yu Gothic UI', 'Segoe UI',
                 'Noto Sans JP', sans-serif;
    background: var(--bg);
    color: #eee;
    min-height: 100vh;
    min-height: 100dvh;
    overflow-x: hidden;
    padding-bottom: var(--safe-env-bottom);
  }

  /* ===== ãƒ˜ãƒƒãƒ€ãƒ¼ ===== */
  header {
    background: linear-gradient(135deg, var(--red), var(--dark-red));
    text-align: center;
    padding: calc(20px + var(--safe-env-top)) 20px 24px;
    position: relative;
    overflow: hidden;
  }
  header::before {
    content: '';
    position: absolute;
    inset: 0;
    background: repeating-linear-gradient(
      45deg, transparent, transparent 20px,
      rgba(0,0,0,.08) 20px, rgba(0,0,0,.08) 40px
    );
  }
  header h1 {
    font-size: clamp(1.2rem, 5vw, 2rem);
    position: relative;
    text-shadow: 2px 2px 4px rgba(0,0,0,.4);
    line-height: 1.4;
  }
  header p {
    margin-top: 6px;
    font-size: clamp(.8rem, 3vw, .95rem);
    opacity: .9;
    position: relative;
  }

  /* ===== å…¥åŠ›ã‚»ã‚¯ã‚·ãƒ§ãƒ³ ===== */
  .input-section {
    max-width: 520px;
    margin: 28px auto;
    padding: 0 16px;
    text-align: center;
  }
  .input-section label {
    font-size: clamp(.95rem, 3.5vw, 1.15rem);
    display: block;
    margin-bottom: 16px;
    line-height: 1.5;
  }
  .input-row {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
    flex-wrap: wrap;
  }
  .input-row input[type="number"] {
    width: 90px;
    padding: 14px 8px;
    font-size: 1.5rem;
    text-align: center;
    border: 2px solid var(--red);
    border-radius: 12px;
    background: var(--card-bg);
    color: #fff;
    outline: none;
    transition: border-color .3s, box-shadow .3s;
    -webkit-appearance: none;
    -moz-appearance: textfield;
  }
  .input-row input:focus {
    border-color: #f39c12;
    box-shadow: 0 0 0 3px rgba(243,156,18,.25);
  }
  .input-row .unit { font-size: 1.1rem; }
  .input-row button {
    padding: 14px 24px;
    font-size: clamp(1rem, 3.5vw, 1.1rem);
    background: linear-gradient(135deg, var(--red), var(--dark-red));
    color: #fff;
    border: none;
    border-radius: 12px;
    cursor: pointer;
    transition: transform .15s, box-shadow .15s;
    -webkit-tap-highlight-color: transparent;
    touch-action: manipulation;
    font-weight: 600;
    white-space: nowrap;
  }
  .input-row button:hover,
  .input-row button:active {
    transform: scale(1.04);
    box-shadow: 0 4px 20px rgba(231,76,60,.45);
  }

  /* ===== çµæœã‚»ã‚¯ã‚·ãƒ§ãƒ³ ===== */
  .result-section {
    max-width: 600px;
    margin: 0 auto;
    padding: 0 16px 20px;
    display: none;
  }
  .result-section.visible { display: block; }

  /* ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼ */
  .counter-area {
    text-align: center;
    margin-bottom: 24px;
  }
  .counter-label {
    font-size: clamp(.85rem, 3vw, 1rem);
    color: #aaa;
    margin-bottom: 4px;
  }
  .counter-number {
    font-size: clamp(2.8rem, 10vw, 3.5rem);
    font-weight: 900;
    color: var(--red);
    line-height: 1.2;
    font-variant-numeric: tabular-nums;
  }
  .counter-sub {
    font-size: clamp(.78rem, 2.8vw, .95rem);
    color: #ccc;
    margin-top: 4px;
    line-height: 1.4;
  }

  /* ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼ */
  .progress-wrap {
    background: var(--card-bg);
    border-radius: 14px;
    height: 32px;
    overflow: hidden;
    margin: 16px 0;
    position: relative;
    border: 1px solid var(--border);
  }
  .progress-bar {
    height: 100%;
    width: 0%;
    border-radius: 14px;
    transition: width .08s linear;
    display: flex;
    align-items: center;
    justify-content: flex-end;
    padding-right: 10px;
    min-width: 40px;
  }
  .progress-bar.safe    { background: linear-gradient(90deg, #2ecc71, #27ae60); }
  .progress-bar.caution { background: linear-gradient(90deg, #f39c12, #e67e22); }
  .progress-bar.danger  { background: linear-gradient(90deg, var(--red), var(--dark-red)); }
  .progress-text {
    font-size: .8rem;
    font-weight: 700;
    text-shadow: 1px 1px 2px rgba(0,0,0,.6);
    white-space: nowrap;
  }

  /* ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³ */
  .timeline {
    position: relative;
    padding-left: 30px;
    margin: 24px 0 10px;
  }
  .timeline::before {
    content: '';
    position: absolute;
    left: 9px;
    top: 0;
    bottom: 0;
    width: 3px;
    background: var(--border);
  }
  .timeline-item {
    position: relative;
    margin-bottom: 18px;
    opacity: 0;
    transform: translateX(-16px);
  }
  .timeline-item.show {
    animation: slideIn .45s forwards;
  }
  .timeline-item .dot {
    position: absolute;
    left: -27px;
    top: 3px;
    width: 15px;
    height: 15px;
    border-radius: 50%;
    border: 3px solid;
  }
  .timeline-item .dot.green  { border-color: #2ecc71; background: var(--card-bg); }
  .timeline-item .dot.yellow { border-color: #f39c12; background: var(--card-bg); }
  .timeline-item .dot.red    { border-color: var(--red); background: var(--red); }
  .timeline-item h3 {
    font-size: clamp(.88rem, 3vw, 1.02rem);
    line-height: 1.4;
  }
  .timeline-item p {
    font-size: clamp(.78rem, 2.5vw, .88rem);
    color: #aaa;
    margin-top: 2px;
  }

  @keyframes slideIn {
    to { opacity: 1; transform: translateX(0); }
  }

  /* è­¦å‘Šã‚«ãƒ¼ãƒ‰ */
  .warning-card {
    background: linear-gradient(135deg, #4a1a1a, #2a0a0a);
    border: 2px solid var(--red);
    border-radius: 16px;
    padding: 24px 16px;
    margin-top: 28px;
    opacity: 0;
    transform: scale(.92);
  }
  .warning-card.show {
    animation: popIn .6s forwards;
  }
  @keyframes popIn {
    50%  { transform: scale(1.02); }
    100% { opacity: 1; transform: scale(1); }
  }
  .warning-card h2 {
    color: var(--red);
    font-size: clamp(1.05rem, 4vw, 1.3rem);
    margin-bottom: 16px;
    text-align: center;
    line-height: 1.4;
  }

  .symptom-grid {
    display: grid;
    grid-template-columns: 1fr;
    gap: 12px;
  }
  @media (min-width: 480px) {
    .symptom-grid {
      grid-template-columns: repeat(2, 1fr);
    }
  }
  .symptom-item {
    background: rgba(231,76,60,.1);
    border-radius: 12px;
    padding: 14px;
    border-left: 4px solid var(--red);
    opacity: 0;
    transform: translateY(10px);
  }
  .symptom-item.show {
    animation: fadeUp .4s forwards;
  }
  @keyframes fadeUp {
    to { opacity: 1; transform: translateY(0); }
  }
  .symptom-item .icon {
    font-size: 1.6rem;
    margin-bottom: 4px;
  }
  .symptom-item h4 {
    font-size: clamp(.88rem, 3vw, .95rem);
    color: #f5a5a5;
    margin-bottom: 4px;
  }
  .symptom-item p {
    font-size: clamp(.78rem, 2.5vw, .85rem);
    color: #bbb;
    line-height: 1.6;
  }

  /* æœ€çµ‚è­¦å‘Š */
  .final-alert {
    text-align: center;
    margin-top: 28px;
    padding: 20px 16px;
    border-radius: 16px;
    background: rgba(231,76,60,.08);
    border: 2px dashed var(--red);
    opacity: 0;
  }
  .final-alert.show {
    animation: pulseIn .7s forwards;
  }
  @keyframes pulseIn {
    0%   { opacity: 0; transform: scale(.9); }
    60%  { transform: scale(1.02); }
    100% { opacity: 1; transform: scale(1); }
  }
  .final-alert .age-result {
    font-size: clamp(2.4rem, 10vw, 3.2rem);
    font-weight: 900;
    color: var(--red);
    animation: pulse 1.5s infinite;
  }
  @keyframes pulse {
    0%, 100% { opacity: 1; }
    50%      { opacity: .45; }
  }
  .final-alert p {
    margin-top: 10px;
    font-size: clamp(.88rem, 3vw, 1rem);
    color: #ccc;
    line-height: 1.8;
  }

  /* å¯¾ç­–ã‚»ã‚¯ã‚·ãƒ§ãƒ³ */
  .advice-card {
    background: linear-gradient(135deg, #0a2a1a, #0a1a2a);
    border: 2px solid #2ecc71;
    border-radius: 16px;
    padding: 24px 16px;
    margin-top: 28px;
    opacity: 0;
    transform: scale(.92);
  }
  .advice-card.show {
    animation: popIn .6s forwards;
  }
  .advice-card h2 {
    color: #2ecc71;
    font-size: clamp(1.05rem, 4vw, 1.3rem);
    margin-bottom: 16px;
    text-align: center;
    line-height: 1.4;
  }
  .advice-list {
    list-style: none;
    display: flex;
    flex-direction: column;
    gap: 10px;
  }
  .advice-list li {
    background: rgba(46,204,113,.08);
    border-radius: 10px;
    padding: 12px 14px;
    border-left: 4px solid #2ecc71;
    font-size: clamp(.82rem, 2.8vw, .92rem);
    line-height: 1.6;
    color: #ccc;
    opacity: 0;
    transform: translateY(8px);
  }
  .advice-list li.show {
    animation: fadeUp .4s forwards;
  }
  .advice-list li strong {
    color: #6fdc9f;
  }

  /* æ³¨æ„æ›¸ã */
  .note {
    max-width: 600px;
    margin: 32px auto 24px;
    padding: 14px 16px;
    background: var(--card-bg);
    border-radius: 10px;
    font-size: clamp(.7rem, 2.3vw, .78rem);
    color: #888;
    line-height: 1.8;
    text-align: center;
  }

  /* ãƒ•ãƒƒã‚¿ãƒ¼ */
  footer {
    text-align: center;
    padding: 16px;
    font-size: .72rem;
    color: #555;
    padding-bottom: calc(16px + var(--safe-env-bottom));
  }

  /* ã‚·ã‚§ã‚¤ã‚¯ */
  .shake { animation: shake .5s; }
  @keyframes shake {
    0%,100% { transform: translateX(0); }
    20%     { transform: translateX(-8px); }
    40%     { transform: translateX(8px); }
    60%     { transform: translateX(-5px); }
    80%     { transform: translateX(5px); }
  }

  /* ç”»é¢ãƒ•ãƒ©ãƒƒã‚·ãƒ¥ */
  .flash-overlay {
    position: fixed;
    inset: 0;
    background: var(--red);
    opacity: 0;
    pointer-events: none;
    z-index: 999;
  }
  .flash-overlay.active {
    animation: flash .6s;
  }
  @keyframes flash {
    0%   { opacity: .55; }
    100% { opacity: 0; }
  }

  /* ãƒªã‚»ãƒƒãƒˆãƒœã‚¿ãƒ³ */
  .reset-btn {
    display: block;
    margin: 28px auto 0;
    padding: 12px 32px;
    font-size: .95rem;
    background: transparent;
    color: #888;
    border: 1px solid #444;
    border-radius: 10px;
    cursor: pointer;
    transition: color .2s, border-color .2s;
    touch-action: manipulation;
  }
  .reset-btn:hover,
  .reset-btn:active {
    color: #eee;
    border-color: #888;
  }
</style>
</head>
<body>

<div class="flash-overlay" id="flashOverlay"></div>

<header>
  <h1>âš ï¸ ã‚¸ã‚¢ãƒŸãƒ³ã‚¢ãƒ¬ãƒ«ã‚®ãƒ¼è­¦å‘Š âš ï¸</h1>
  <p>ãƒ˜ã‚¢ã‚«ãƒ©ãƒ¼ã«æ½œã‚€è¦‹ãˆãªã„ãƒªã‚¹ã‚¯ã‚’å¯è¦–åŒ–</p>
</header>

<section class="input-section" id="inputSection">
  <label>æ¯›æŸ“ã‚ã‚’å§‹ã‚ãŸå¹´é½¢ï¼ˆã¾ãŸã¯å§‹ã‚ã‚‹äºˆå®šã®å¹´é½¢ï¼‰ã‚’<br>å…¥åŠ›ã—ã¦ãã ã•ã„</label>
  <div class="input-row">
    <input type="number" id="startAge" inputmode="numeric" pattern="[0-9]*"
           min="10" max="80" placeholder="25" enterkeyhint="go">
    <span class="unit">æ­³</span>
    <button id="calcBtn">è¨ºæ–­ã™ã‚‹</button>
  </div>
</section>

<section class="result-section" id="resultSection">
  <div class="counter-area">
    <div class="counter-label">ç´¯è¨ˆãƒ˜ã‚¢ã‚«ãƒ©ãƒ¼å›æ•°</div>
    <div class="counter-number" id="counterNumber">0</div>
    <div class="counter-sub" id="counterSub"></div>
  </div>

  <div class="progress-wrap">
    <div class="progress-bar safe" id="progressBar">
      <span class="progress-text" id="progressText"></span>
    </div>
  </div>

  <div class="timeline" id="timeline"></div>

  <div class="final-alert" id="finalAlert">
    <div class="age-result" id="ageResult"></div>
    <p id="alertMessage"></p>
  </div>

  <div class="warning-card" id="warningCard">
    <h2>ğŸš¨ ã‚¸ã‚¢ãƒŸãƒ³ã‚¢ãƒ¬ãƒ«ã‚®ãƒ¼ã®ä¸»ãªç—‡çŠ¶ ğŸš¨</h2>
    <div class="symptom-grid" id="symptomGrid"></div>
  </div>

  <div class="advice-card" id="adviceCard">
    <h2>ğŸ’¡ ãƒªã‚¹ã‚¯ã‚’æ¸›ã‚‰ã™ãŸã‚ã«</h2>
    <ul class="advice-list" id="adviceList"></ul>
  </div>

  <button class="reset-btn" id="resetBtn">ã‚‚ã†ä¸€åº¦è¨ºæ–­ã™ã‚‹</button>
</section>

<div class="note">
  â€» æœ¬ã‚¢ãƒ—ãƒªã®æƒ…å ±ã¯ä¸€èˆ¬çš„ãªè¦‹è§£ã«åŸºã¥ãã‚‚ã®ã§ã‚ã‚Šã€åŒ»å­¦çš„è¨ºæ–­ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚<br>
  â€»ã€Œ150å›ä»¥é™ã«ãƒªã‚¹ã‚¯ãŒé«˜ã¾ã‚‹ã€ã¨ã„ã†èª¬ã«åŸºã¥ã„ãŸç›®å®‰ã§ã™ã€‚<br>
  â€» å€‹äººå·®ãŒã‚ã‚Šã€å°‘ãªã„å›æ•°ã§ã‚‚ç™ºç—‡ã™ã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ã€‚<br>
  â€» ç•°å¸¸ã‚’æ„Ÿã˜ãŸã‚‰å¿…ãšçš®è†šç§‘åŒ»ã«ã”ç›¸è«‡ãã ã•ã„ã€‚
</div>

<footer>Hair Dye Allergy Risk Warning App</footer>

<script>
const RISK_THRESHOLD = 150;
const INTERVAL_MONTHS = 2;
let animInterval = null;

const symptoms = [
  { icon: 'ğŸ˜£', title: 'é ­çš®ã®ã‹ã¶ã‚Œãƒ»ç‚ç—‡', desc: 'é ­çš®ãŒèµ¤ãè…«ã‚Œã€å¼·ã„ç—›ã¿ã‚„ã‹ã‚†ã¿ãŒç”Ÿã˜ã¾ã™ã€‚æ°´ã¶ãã‚ŒãŒã§ãã‚‹ã“ã¨ã‚‚ã‚ã‚Šã¾ã™ã€‚' },
  { icon: 'ğŸ˜–', title: 'é¡”é¢ã®è…«ã‚Œ', desc: 'ç›®ã®å‘¨ã‚Šãƒ»é¡ãƒ»é ¬ãŒå¤§ããè…«ã‚Œä¸ŠãŒã‚Šã€åˆ¥äººã®ã‚ˆã†ãªé¡”ã«ãªã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚' },
  { icon: 'ğŸ¤§', title: 'å…¨èº«ã®è•éº»ç–¹', desc: 'é ­çš®ã ã‘ã§ãªãã€å…¨èº«ã«è•éº»ç–¹ãŒåºƒãŒã‚Šã€æ¿€ã—ã„ã‹ã‚†ã¿ãŒç¶šãã¾ã™ã€‚' },
  { icon: 'ğŸ˜°', title: 'å‘¼å¸å›°é›£ï¼ˆã‚¢ãƒŠãƒ•ã‚£ãƒ©ã‚­ã‚·ãƒ¼ï¼‰', desc: 'é‡ç¯¤ãªå ´åˆã€æ°—é“ãŒè…«ã‚Œã¦å‘¼å¸å›°é›£ã«é™¥ã‚Šã€å‘½ã«é–¢ã‚ã‚‹å±é™ºãŒã‚ã‚Šã¾ã™ã€‚' },
  { icon: 'ğŸ’§', title: 'æµ¸å‡ºæ¶²ãƒ»ãŸã ã‚Œ', desc: 'é ­çš®ã‹ã‚‰æ¶²ä½“ãŒã«ã˜ã¿å‡ºã—ã€ã‹ã•ã¶ãŸã‚„ãŸã ã‚ŒãŒåºƒç¯„å›²ã«ç”Ÿã˜ã¾ã™ã€‚' },
  { icon: 'ğŸš«', title: 'æ°¸ç¶šçš„ãªä½¿ç”¨ä¸å¯', desc: 'ä¸€åº¦ç™ºç—‡ã™ã‚‹ã¨ä¸€ç”Ÿã‚¸ã‚¢ãƒŸãƒ³ç³»æŸ“æ¯›å‰¤ãŒä½¿ãˆãªããªã‚Šã¾ã™ã€‚æ²»ã‚‹ã“ã¨ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚' },
];

const advices = [
  { text: '<strong>ãƒ‘ãƒƒãƒãƒ†ã‚¹ãƒˆã‚’æ¯å›è¡Œã†</strong> â€” æŸ“æ¯›ã®48æ™‚é–“å‰ã«è…•ã®å†…å´ã§å¿…ãšãƒ†ã‚¹ãƒˆã—ã¾ã—ã‚‡ã†ã€‚' },
  { text: '<strong>ã‚¸ã‚¢ãƒŸãƒ³ãƒ•ãƒªãƒ¼ã®æŸ“æ¯›å‰¤ã‚’é¸ã¶</strong> â€” ãƒ˜ãƒŠã€ãƒ˜ã‚¢ãƒãƒ‹ã‚­ãƒ¥ã‚¢ã€ã‚«ãƒ©ãƒ¼ãƒˆãƒªãƒ¼ãƒˆãƒ¡ãƒ³ãƒˆãªã©ä»£æ›¿å“ãŒã‚ã‚Šã¾ã™ã€‚' },
  { text: '<strong>æŸ“æ¯›ã®é »åº¦ã‚’æ¸›ã‚‰ã™</strong> â€” ãƒªã‚¿ãƒƒãƒï¼ˆæ ¹å…ƒã®ã¿ï¼‰ã«ã—ã¦å…¨ä½“æŸ“ã‚ã®å›æ•°ã‚’æ¸›ã‚‰ã—ã¾ã—ã‚‡ã†ã€‚' },
  { text: '<strong>é ­çš®ã«è–¬å‰¤ã‚’ã¤ã‘ãªã„</strong> â€” ç¾å®¹å¸«ã«ã€Œé ­çš®ã«ã¤ã‘ãªã„ã§ã€ã¨ä¼ãˆã¾ã—ã‚‡ã†ã€‚' },
  { text: '<strong>ç•°å¤‰ã‚’æ„Ÿã˜ãŸã‚‰ã™ãä¸­æ­¢</strong> â€” å°‘ã—ã§ã‚‚ã‹ã‚†ã¿ãƒ»èµ¤ã¿ãŒå‡ºãŸã‚‰ã€ãã®å¾Œã®ä½¿ç”¨ã‚’ã‚„ã‚ã¦çš®è†šç§‘ã¸ã€‚' },
];

const milestones = [
  { count: 1,   label: 'åˆã‚ã¦ã®ãƒ˜ã‚¢ã‚«ãƒ©ãƒ¼', color: 'green' },
  { count: 30,  label: '30å›ç›® â€” ã¾ã å®‰å…¨åœã§ã™ãŒè“„ç©ã¯å§‹ã¾ã£ã¦ã„ã¾ã™', color: 'green' },
  { count: 60,  label: '60å›ç›® â€” ä½“å†…ã®æ„Ÿä½œãŒé€²è¡Œä¸­', color: 'green' },
  { count: 100, label: '100å›ç›® â€” æ³¨æ„ã‚¾ãƒ¼ãƒ³ã«çªå…¥', color: 'yellow' },
  { count: 130, label: '130å›ç›® â€” å±é™ºãŒè¿«ã£ã¦ã„ã¾ã™', color: 'yellow' },
  { count: 150, label: '150å›ç›® â€” ç™ºç—‡ãƒªã‚¹ã‚¯ãŒæ€¥æ¿€ã«é«˜ã¾ã‚‹!', color: 'red' },
];

// ã‚¤ãƒ™ãƒ³ãƒˆè¨­å®š
const calcBtn = document.getElementById('calcBtn');
const startAgeInput = document.getElementById('startAge');
const resetBtn = document.getElementById('resetBtn');

calcBtn.addEventListener('click', startSimulation);
startAgeInput.addEventListener('keydown', (e) => {
  if (e.key === 'Enter') startSimulation();
});
resetBtn.addEventListener('click', resetApp);

function resetApp() {
  if (animInterval) { clearInterval(animInterval); animInterval = null; }
  document.getElementById('resultSection').classList.remove('visible');
  document.getElementById('inputSection').scrollIntoView({ behavior: 'smooth' });
  startAgeInput.value = '';
  startAgeInput.focus();
}

function startSimulation() {
  const age = parseInt(startAgeInput.value, 10);
  if (isNaN(age) || age < 1 || age > 100) {
    startAgeInput.classList.add('shake');
    setTimeout(() => startAgeInput.classList.remove('shake'), 500);
    return;
  }

  // å‰ã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ã‚¯ãƒªã‚¢
  if (animInterval) { clearInterval(animInterval); animInterval = null; }

  const section = document.getElementById('resultSection');
  section.classList.add('visible');

  // ãƒªã‚»ãƒƒãƒˆ
  document.getElementById('timeline').innerHTML = '';
  document.getElementById('finalAlert').classList.remove('show');
  document.getElementById('warningCard').classList.remove('show');
  document.getElementById('adviceCard').classList.remove('show');
  document.getElementById('symptomGrid').innerHTML = '';
  document.getElementById('adviceList').innerHTML = '';

  // ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã‚’é–‰ã˜ã¦ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«
  startAgeInput.blur();
  setTimeout(() => {
    section.scrollIntoView({ behavior: 'smooth', block: 'start' });
  }, 100);

  const riskAge = age + (RISK_THRESHOLD * INTERVAL_MONTHS) / 12;
  let count = 0;
  const counterEl = document.getElementById('counterNumber');
  const counterSub = document.getElementById('counterSub');
  const bar = document.getElementById('progressBar');
  const barText = document.getElementById('progressText');
  let msIdx = 0;

  animInterval = setInterval(() => {
    count++;
    const pct = Math.min((count / RISK_THRESHOLD) * 100, 100);
    const currentAge = age + (count * INTERVAL_MONTHS) / 12;

    counterEl.textContent = count;
    counterSub.textContent = `ï¼ˆ${currentAge.toFixed(1)} æ­³ ãƒ» é–‹å§‹ã‹ã‚‰ ${((count * INTERVAL_MONTHS) / 12).toFixed(1)} å¹´ï¼‰`;

    bar.style.width = pct + '%';
    barText.textContent = Math.round(pct) + '%';

    if (pct < 60) {
      bar.className = 'progress-bar safe';
    } else if (pct < 90) {
      bar.className = 'progress-bar caution';
    } else {
      bar.className = 'progress-bar danger';
    }

    if (msIdx < milestones.length && count === milestones[msIdx].count) {
      addTimelineItem(milestones[msIdx], currentAge);
      msIdx++;
    }

    if (count >= RISK_THRESHOLD) {
      clearInterval(animInterval);
      animInterval = null;
      showFinalWarning(age, riskAge);
    }
  }, 22);
}

function addTimelineItem(ms, currentAge) {
  const tl = document.getElementById('timeline');
  const div = document.createElement('div');
  div.className = 'timeline-item';
  div.innerHTML =
    '<div class="dot ' + ms.color + '"></div>' +
    '<h3>' + ms.label + '</h3>' +
    '<p>' + currentAge.toFixed(0) + ' æ­³æ™‚ç‚¹</p>';
  tl.appendChild(div);
  requestAnimationFrame(() => div.classList.add('show'));
}

function showFinalWarning(startAge, riskAge) {
  // ç”»é¢ãƒ•ãƒ©ãƒƒã‚·ãƒ¥
  const flash = document.getElementById('flashOverlay');
  flash.classList.remove('active');
  void flash.offsetWidth;
  flash.classList.add('active');
  setTimeout(() => flash.classList.remove('active'), 650);

  // ãƒã‚¤ãƒ–ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆå¯¾å¿œç«¯æœ«ã®ã¿ï¼‰
  if (navigator.vibrate) navigator.vibrate([100, 50, 200]);

  // æœ€çµ‚è­¦å‘Š
  const fa = document.getElementById('finalAlert');
  document.getElementById('ageResult').textContent = Math.round(riskAge) + ' æ­³';
  document.getElementById('alertMessage').innerHTML =
    startAge + ' æ­³ã‹ã‚‰2ãƒ¶æœˆã«1å›ã®ãƒ˜ã‚¢ã‚«ãƒ©ãƒ¼ã‚’ç¶šã‘ã‚‹ã¨ã€<br>' +
    '<strong>ç´„ ' + Math.round(riskAge) + ' æ­³ã§150å›</strong>ã«åˆ°é”ã—ã¾ã™ã€‚<br>' +
    'ã“ã®æ™‚ç‚¹ã§ã‚¸ã‚¢ãƒŸãƒ³ã‚¢ãƒ¬ãƒ«ã‚®ãƒ¼ã®ç™ºç—‡ãƒªã‚¹ã‚¯ãŒ<br>æ€¥æ¿€ã«é«˜ã¾ã‚‹ã¨è¨€ã‚ã‚Œã¦ã„ã¾ã™ã€‚';
  setTimeout(() => {
    fa.classList.add('show');
    fa.scrollIntoView({ behavior: 'smooth', block: 'center' });
  }, 250);

  // ç—‡çŠ¶ã‚«ãƒ¼ãƒ‰
  setTimeout(() => {
    const card = document.getElementById('warningCard');
    card.classList.add('show');
    const grid = document.getElementById('symptomGrid');
    symptoms.forEach((s, i) => {
      const div = document.createElement('div');
      div.className = 'symptom-item';
      div.innerHTML = '<div class="icon">' + s.icon + '</div><h4>' + s.title + '</h4><p>' + s.desc + '</p>';
      grid.appendChild(div);
      setTimeout(() => div.classList.add('show'), i * 160);
    });
  }, 1000);

  // å¯¾ç­–ã‚«ãƒ¼ãƒ‰
  setTimeout(() => {
    const card = document.getElementById('adviceCard');
    card.classList.add('show');
    const list = document.getElementById('adviceList');
    advices.forEach((a, i) => {
      const li = document.createElement('li');
      li.innerHTML = a.text;
      list.appendChild(li);
      setTimeout(() => li.classList.add('show'), i * 150);
    });
  }, 2200);
}
</script>
</body>
</html>
